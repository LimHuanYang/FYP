<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Dashboard</title>
    <link
      href="vendor/fontawesome-free/css/all.min.css"
      rel="stylesheet"
      type="text/css"
    />
    <link href="css/sb-admin-2.min.css" rel="stylesheet" />
  </head>
  <body id="page-top">
    <div id="wrapper">
      <ul
        class="navbar-nav bg-gradient-primary sidebar sidebar-dark accordion"
        id="accordionSidebar"
      >
        <a
          class="sidebar-brand d-flex align-items-center justify-content-center"
          href="dashboard.html"
        >
          <div class="sidebar-brand-text mx-3">Nutribalance</div>
        </a>
        <hr class="sidebar-divider my-0" />
        <li class="nav-item active">
          <a class="nav-link" href="dashboard.html">
            <i class="fas fa-fw fa-tachometer-alt"></i>
            <span>Dashboard</span></a
          >
        </li>
        <li class="nav-item">
          <a class="nav-link" href="fooddiary.html">
            <i class="fas fa-fw fa-egg"></i>
            <span>Food Diary</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="searchfood.html">
            <i class="fas fa-fw fa-search"></i>
            <span>Search Food</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="comparefood.html">
            <i class="fas fa-fw fa-clipboard-list"></i>
            <span>Food Comparison</span>
          </a>
        </li>
      </ul>
      <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
          <nav
            class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow"
          >
            <button
              id="sidebarToggleTop"
              class="btn btn-link d-md-none rounded-circle mr-3"
            >
              <i class="fa fa-bars"></i>
            </button>
            <ul class="navbar-nav ml-auto">
              <li class="nav-item dropdown no-arrow d-sm-none">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="searchDropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <i class="fas fa-search fa-fw"></i>
                </a>
                <div
                  class="dropdown-menu dropdown-menu-right p-3 shadow animated--grow-in"
                  aria-labelledby="searchDropdown"
                >
                  <form class="form-inline mr-auto w-100 navbar-search">
                    <div class="input-group">
                      <input
                        type="text"
                        class="form-control bg-light border-0 small"
                        placeholder="Search for..."
                        aria-label="Search"
                        aria-describedby="basic-addon2"
                      />
                      <div class="input-group-append">
                        <button class="btn btn-primary" type="button">
                          <i class="fas fa-search fa-sm"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
              </li>
              <li class="nav-item dropdown no-arrow">
                <a
                  class="nav-link dropdown-toggle"
                  href="#"
                  id="userDropdown"
                  role="button"
                  data-toggle="dropdown"
                  aria-haspopup="true"
                  aria-expanded="false"
                >
                  <span
                    class="mr-2 d-none d-lg-inline text-gray-600 small"
                    id="emailprofile"
                  ></span>
                  <img
                    class="img-profile rounded-circle"
                    src="img/undraw_profile.svg"
                  />
                </a>
                <div
                  class="dropdown-menu dropdown-menu-right shadow animated--grow-in"
                  aria-labelledby="userDropdown"
                >
                  <a class="dropdown-item" href="#">
                    <i class="fas fa-user fa-sm fa-fw mr-2 text-gray-400"></i>
                    Profile
                  </a>
                  <div class="dropdown-divider"></div>
                  <a
                    class="dropdown-item"
                    href="#"
                    data-toggle="modal"
                    data-target="#logoutModal"
                  >
                    <i
                      class="fas fa-sign-out-alt fa-sm fa-fw mr-2 text-gray-400"
                    ></i>
                    Logout
                  </a>
                </div>
              </li>
            </ul>
          </nav>
          <div class="container-fluid">
            <div
              class="d-sm-flex align-items-center justify-content-between mb-4"
            >
              <h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
              <a
                href="fooddiary.html"
                class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"
                ><i class="fas fa-fw fa-hamburger"></i> Add Food</a
              >
            </div>
            <div class="row">
              <div class="col-xl-6 col-md-6 mb-4">
                <div class="card border-left-danger shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <div
                          class="text-xs font-weight-bold text-danger text-uppercase mb-1"
                        >
                          Calories Intake
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                          <span id="totalcaloriesintake"></span
                          ><span>kcal</span>
                        </div>
                      </div>
                      <div class="col-auto">
                        <i class="fas fa-fire fa-2x text-gray-300"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-6 col-md-6 mb-4">
                <div class="card border-left-success shadow h-100 py-2">
                  <div class="card-body">
                    <div class="row no-gutters align-items-center">
                      <div class="col mr-2">
                        <div
                          class="text-xs font-weight-bold text-success text-uppercase mb-1"
                        >
                          Calories Remaining
                        </div>
                        <div class="h5 mb-0 font-weight-bold text-gray-800">
                          <span id="caloriesremaining"></span><span>kcal</span>
                        </div>
                      </div>
                      <div class="col-auto">
                        <i class="fas fa-utensils fa-2x text-gray-300"></i>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-xl-6 col-lg-7 mb-4">
                <div class="card shadow mb-4">
                  <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                      Nutrient Intake
                    </h6>
                  </div>
                  <div class="card-body">
                    <h4 class="small font-weight-bold">
                      Carbohydrate<span
                        id="carbsintake"
                        class="float-right"
                      ></span>
                    </h4>
                    <div class="progress mb-4">
                      <div
                        id="carbsprogressbar"
                        class="progress-bar"
                        role="progressbar"
                        style="width: 0%"
                        aria-valuenow="0"
                        aria-valuemin="0"
                        aria-valuemax="325"
                      ></div>
                    </div>
                    <h4 class="small font-weight-bold">
                      Protein
                      <span class="float-right" id="proteinintake"></span>
                    </h4>
                    <div class="progress mb-4">
                      <div
                        id="proteinprogressbar"
                        class="progress-bar"
                        role="progressbar"
                        style="width: 0%; background-color: #ff0000"
                        aria-valuenow="40"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                    <h4 class="small font-weight-bold">
                      Fats<span class="float-right" id="fatintake"></span>
                    </h4>
                    <div class="progress mb-4">
                      <div
                        id="fatprogressbar"
                        class="progress-bar bg-warning"
                        role="progressbar"
                        style="width: 0%"
                        aria-valuenow="60"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                    <h4 class="small font-weight-bold">
                      Fiber <span class="float-right" id="fiberintake"></span>
                    </h4>
                    <div class="progress mb-4">
                      <div
                        id="fiberprogressbar"
                        class="progress-bar bg-success"
                        role="progressbar"
                        style="width: 0%"
                        aria-valuenow="80"
                        aria-valuemin="0"
                        aria-valuemax="100"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xl-6 col-lg-5">
                <div class="card shadow mb-4">
                  <div
                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
                  >
                    <h6 class="m-0 font-weight-bold text-primary">
                      Nutrient Intake Ratio
                    </h6>
                    <div class="dropdown no-arrow">
                      <a
                        class="dropdown-toggle"
                        href="#"
                        role="button"
                        id="dropdownMenuLink"
                        data-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="false"
                      >
                      </a>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart-pie pt-4 pb-2">
                      <canvas id="myPieChart"></canvas>
                    </div>
                    <div class="mt-4 text-center small">
                      <span class="mr-2">
                        <i class="fas fa-circle text-primary"></i> Carbohydrate
                      </span>
                      <span class="mr-2">
                        <i class="fas fa-circle text-danger"></i> Protein
                      </span>
                      <span class="mr-2">
                        <i class="fas fa-circle text-warning"></i> Fat
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-xl-12 col-lg-12">
                <div class="card shadow mb-4">
                  <div
                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between"
                  >
                    <h6 class="m-0 font-weight-bold text-primary">
                      Calories Intake Overview
                    </h6>
                    <div class="dropdown no-arrow">
                      <a
                        class="dropdown-toggle"
                        href="#"
                        role="button"
                        id="dropdownMenuLink"
                        data-toggle="dropdown"
                        aria-haspopup="true"
                        aria-expanded="false"
                      >
                        <i
                          class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"
                        ></i>
                      </a>
                      <div
                        class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                        aria-labelledby="dropdownMenuLink"
                      >
                        <div class="dropdown-header">Dropdown Header:</div>
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#"
                          >Something else here</a
                        >
                      </div>
                    </div>
                  </div>
                  <div class="card-body">
                    <div class="chart-area">
                      <canvas id="myAreaChart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <footer class="sticky-footer bg-white">
          <div class="container my-auto">
            <div class="copyright text-center my-auto">
              <span>Copyright &copy; Your Website 2021</span>
            </div>
          </div>
        </footer>
      </div>
    </div>
    <a class="scroll-to-top rounded" href="#page-top">
      <i class="fas fa-angle-up"></i>
    </a>
    <div
      class="modal fade"
      id="logoutModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
            <button
              class="close"
              type="button"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">×</span>
            </button>
          </div>
          <div class="modal-body">
            Select "Logout" below if you are ready to end your current session.
          </div>
          <div class="modal-footer">
            <button
              class="btn btn-secondary"
              type="button"
              data-dismiss="modal"
            >
              Cancel
            </button>
            <a class="btn btn-primary" href="login.html">Logout</a>
          </div>
        </div>
      </div>
    </div>
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
    <script src="js/sb-admin-2.min.js"></script>
    <script src="vendor/chart.js/Chart.min.js"></script>
    <script src="js/demo/chart-area-demo.js"></script>
  </body>
</html>
<script src="checklogin.js"></script>
<script>
  let totalcaloriesintake;
  let dailyCalories = Array(31).fill(0);
  function fetchmealData() {
    $.ajax({
      url: "dashboard.php",
      method: "POST",
      data: {
        UID: UID,
      },
      dataType: "json",
      success: function (response) {
        console.log(response);
        totalcaloriesintake = calculateTotalCalories(response, "Energy");
        carbsintake = calculateTotalCalories(
          response,
          "Carbohydrate, by difference"
        );
        proteinintake = calculateTotalCalories(response, "Protein");
        fatsintake = calculateTotalCalories(response, "Total lipid (fat)");
        fiberintake = calculateTotalCalories(response, "Fiber, total dietary");
        document.getElementById("totalcaloriesintake").innerHTML =
          totalcaloriesintake;
        document.getElementById("carbsintake").innerHTML = carbsintake + "g";
        document.getElementById("proteinintake").innerHTML =
          proteinintake + "g";
        document.getElementById("fatintake").innerHTML = fatsintake + "g";
        document.getElementById("fiberintake").innerHTML = fiberintake + "g";
        fetchuserData(
          UID,
          totalcaloriesintake,
          carbsintake,
          proteinintake,
          fatsintake,
          fiberintake
        );
        response.forEach((meal) => {
          
          const day = new Date(meal.date).getDate();
          
          const calories = meal.foodNutrients.find(
            (nutrient) => nutrient.nutrient.number === "208"
          );
          if (calories) {
            dailyCalories[day - 1] += calories.amount;
          }
        });
        
        updateAreaChart(dailyCalories);
        return response;
      },
      error: function (error) {
        console.error("Error fetching data:", error);
      },
    });
  }
  function fetchuserData(
    UID,
    totalcaloriesintake,
    carbsintake,
    proteinintake,
    fatintake,
    fiberintake
  ) {
    $.ajax({
      url: "fetchuser.php",
      method: "POST",
      data: {
        UID: UID,
      },
      dataType: "json",
      success: function (response) {
        console.log(response);
        const bmr = calculateBMR(response);
        const carbstarget = (bmr * 25) / 100 / 4;
        const proteintarget = (bmr * 25) / 100 / 4;
        const fattarget = (bmr * 25) / 100 / 9;
        const fibertarget = response.gender === "female" ? 25 : 38;
        document.getElementById("caloriesremaining").innerHTML =
          bmr - totalcaloriesintake;
        document.getElementById("carbsprogressbar").style.width = `${
          (carbsintake / carbstarget) * 100
        }%`;
        document.getElementById("proteinprogressbar").style.width = `${
          (proteinintake / proteintarget) * 100
        }%`;
        document.getElementById("fatprogressbar").style.width = `${
          (fatintake / fattarget) * 100
        }%`;
        document.getElementById("fiberprogressbar").style.width = `${
          (fiberintake / fibertarget) * 100
        }%`;
        createPieChart(carbsintake, proteinintake, fatintake);
      },
      error: function (error) {
        console.error("Error fetching data:", error);
      },
    });
  }
  function calculateTotalCalories(meals, selectednutrient) {
    const currentDate = new Date().toISOString().split("T")[0];
    let totalCalories = 0;
    for (const meal of meals) {
      if (meal.date === currentDate) {
        let mealCalories = 0;
        for (const nutrient of meal.foodNutrients) {
          if (nutrient.nutrient.name === selectednutrient) {
            mealCalories += nutrient.amount * meal.servings_value;
          }
        }
        totalCalories += mealCalories;
      }
    }
    return totalCalories.toFixed(2);
  }
  function calculateBMR(userData) {
    
    const { gender, weight, height, dob } = userData;
    
    const dobDate = new Date(dob);
    const currentDate = new Date();
    const age = currentDate.getFullYear() - dobDate.getFullYear();
    
    let bmr;
    if (gender === "male") {
      bmr = Math.round(66.5 + 13.75 * weight + 5.003 * height - 6.75 * age);
    } else if (gender === "female") {
      bmr = Math.round(655.1 + 9.563 * weight + 1.85 * height - 4.676 * age);
    } else {
      
      console.error("Invalid gender:", gender);
      return null;
    }
    return bmr;
  }
  (Chart.defaults.global.defaultFontFamily = "Nunito"),
    '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
  Chart.defaults.global.defaultFontColor = "#858796";
  function createPieChart(carbsintake, proteinintake, fatintake) {
    var ctx = document.getElementById("myPieChart");
    var myPieChart = new Chart(ctx, {
      type: "doughnut",
      data: {
        labels: ["Carbohydrate", "Protein", "Fat"],
        datasets: [
          {
            data: [carbsintake, proteinintake, fatintake],
            backgroundColor: ["#0d6efd", "#FF0000", "#f0ad4e"],
            hoverBackgroundColor: ["#0a58ca", "#cc0000", "#d49c32"],
            hoverBorderColor: ["#094080", "#8c0000", "#9b7c26"],
          },
        ],
      },
      options: {
        maintainAspectRatio: false,
        tooltips: {
          backgroundColor: "rgb(255,255,255)",
          bodyFontColor: "#858796",
          borderColor: "#dddfeb",
          borderWidth: 1,
          xPadding: 15,
          yPadding: 15,
          displayColors: false,
          caretPadding: 10,
        },
        legend: {
          display: false,
        },
        cutoutPercentage: 80,
      },
    });
  }
Chart.defaults.global.defaultFontFamily = 'Nunito', '-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif';
Chart.defaults.global.defaultFontColor = '#858796';
function number_format(number, decimals, dec_point, thousands_sep) {
  
  
  number = (number + '').replace(',', '').replace(' ', '');
  var n = !isFinite(+number) ? 0 : +number,
    prec = !isFinite(+decimals) ? 0 : Math.abs(decimals),
    sep = (typeof thousands_sep === 'undefined') ? ',' : thousands_sep,
    dec = (typeof dec_point === 'undefined') ? '.' : dec_point,
    s = '',
    toFixedFix = function(n, prec) {
      var k = Math.pow(10, prec);
      return '' + Math.round(n * k) / k;
    };
  
  s = (prec ? toFixedFix(n, prec) : '' + Math.round(n)).split('.');
  if (s[0].length > 3) {
    s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep);
  }
  if ((s[1] || '').length < prec) {
    s[1] = s[1] || '';
    s[1] += new Array(prec - s[1].length + 1).join('0');
  }
  return s.join(dec);
}
function updateAreaChart(dailyCalories) {
var ctx = document.getElementById("myAreaChart");
var myLineChart = new Chart(ctx, {
  type: "line",
  data: {
    labels: [
      "Day 1",
      "Day 2",
      "Day 3",
      "Day 4",
      "Day 5",
      "Day 6",
      "Day 7",
      "Day 8",
      "Day 9",
      "Day 10",
      "Day 11",
      "Day 12",
      "Day 13",
      "Day 14",
      "Day 15",
      "Day 16",
      "Day 17",
      "Day 18",
      "Day 19",
      "Day 20",
      "Day 21",
      "Day 22",
      "Day 23",
      "Day 24",
      "Day 25",
      "Day 26",
      "Day 27",
      "Day 28",
      "Day 29",
      "Day 30",
      "Day 31",
    ],
    datasets: [
      {
        label: "Calories Intake",
        lineTension: 0.3,
        backgroundColor: "rgba(78, 115, 223, 0.05)",
        borderColor: "rgba(78, 115, 223, 1)",
        pointRadius: 3,
        pointBackgroundColor: "rgba(78, 115, 223, 1)",
        pointBorderColor: "rgba(78, 115, 223, 1)",
        pointHoverRadius: 3,
        pointHoverBackgroundColor: "rgba(78, 115, 223, 1)",
        pointHoverBorderColor: "rgba(78, 115, 223, 1)",
        pointHitRadius: 10,
        pointBorderWidth: 2,
        data: dailyCalories,
      },
    ],
  },
  options: {
    maintainAspectRatio: false,
    layout: {
      padding: {
        left: 10,
        right: 25,
        top: 25,
        bottom: 0,
      },
    },
    scales: {
      xAxes: [
        {
          time: {
            unit: "date",
          },
          gridLines: {
            display: false,
            drawBorder: false,
          },
          ticks: {
            maxTicksLimit: 7,
          },
        },
      ],
      yAxes: [
        {
          ticks: {
            maxTicksLimit: 5,
            padding: 10,
            
            callback: function (value, index, values) {
              return number_format(value) + "kcal";
            },
          },
          gridLines: {
            color: "rgb(234, 236, 244)",
            zeroLineColor: "rgb(234, 236, 244)",
            drawBorder: false,
            borderDash: [2],
            zeroLineBorderDash: [2],
          },
        },
      ],
    },
    legend: {
      display: true,
    },
    tooltips: {
      backgroundColor: "rgb(255,255,255)",
      bodyFontColor: "#858796",
      titleMarginBottom: 10,
      titleFontColor: "#6e707e",
      titleFontSize: 14,
      borderColor: "#dddfeb",
      borderWidth: 1,
      xPadding: 15,
      yPadding: 15,
      displayColors: false,
      intersect: false,
      mode: "index",
      caretPadding: 10,
      callbacks: {
        label: function (tooltipItem, chart) {
          var datasetLabel =
            chart.datasets[tooltipItem.datasetIndex].label || "";
          return (
            datasetLabel + ": " + number_format(tooltipItem.yLabel) + "kcal"
          );
        },
      },
    },
  },
});}
  fetchmealData();
</script>
